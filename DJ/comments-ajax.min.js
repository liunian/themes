/*!
 * WordPress jQuery-Ajax-Comments v1.3 by Willin Kan.
 * URI: http://willin.heliohost.org/?p=1271
 */
jQuery(document).ready(function(f){var l="1",i=templatePath+"/comments-ajax.php",e=templatePath.substr(0,templatePath.indexOf("wp-content")),t=e+"wp-admin/images/wpspin_light.gif",u=e+"wp-admin/images/no.png",k=e+"wp-admin/images/yes.png",d='<div id="loading"><img src="'+t+'" style="vertical-align:middle;" alt=""/> 正在提交, 請稍候...</div>',b='<div id="error">#</div>',a='"><img src="'+k+'" style="vertical-align:middle;" alt=""/> 提交成功',s=', 刷新頁面之前可以<a rel="nofollow" class="comment-reply-link" href="#edit" onclick=\'return addComment.moveForm("',r=")'>再编辑</a>",c="取消编辑",m,h=1,q=[];q.push("");$comments=f("#comments-title");$cancel=f("#cancel-comment-reply-link");cancel_text=$cancel.text();$submit=f("#commentform #submit");$submit.attr("disabled",false);f("#comment").after(d+b);f("#loading").hide();f("#error").hide();$body=(window.opera)?(document.compatMode=="CSS1Compat"?f("html"):f("body")):f("html,body");f("#commentform").submit(function(){f("#loading").slideDown();$submit.attr("disabled",true).fadeTo("slow",0.5);if(m){f("#comment").after('<input type="text" name="edit_id" id="edit_id" value="'+m+'" style="display:none;" />')}f.ajax({url:i,data:f(this).serialize(),type:f(this).attr("method"),error:function(v){f("#loading").slideUp();f("#error").slideDown().html('<img src="'+u+'" style="vertical-align:middle;" alt=""/> '+v.responseText);setTimeout(function(){$submit.attr("disabled",false).fadeTo("slow",1);f("#error").slideUp()},3000)},success:function(A){f("#loading").hide();q.push(f("#comment").val());f("textarea").each(function(){this.value=""});var x=addComment,z=x.I("cancel-comment-reply-link"),v=x.I("wp-temp-form-div"),B=x.I(x.respondId),w=x.I("comment_post_ID").value,y=x.I("comment_parent").value;if(!m&&$comments.length){n=parseInt($comments.text().match(/\d+/));$comments.text($comments.text().replace(n,n+1))}new_htm='" id="new_comm_'+h+'"></';new_htm=(y=="0")?('\n<ol style="clear:both;" class="commentlist new_com'+new_htm+"ol>"):('\n<ul class="children'+new_htm+"ul>");ok_htm='\n<span id="success_'+h+a;if(l=="1"){div_=(document.body.innerHTML.indexOf("div-comment-")==-1)?"":((document.body.innerHTML.indexOf("li-comment-")==-1)?"div-":"");ok_htm=ok_htm.concat(s,div_,"comment-",y,'", "',y,'", "respond", "',w,'", ',h,r)}ok_htm+="</span><span></span>\n";f("#respond").before(new_htm);f("#new_comm_"+h).hide().append(A);f("#new_comm_"+h+" li").append(ok_htm);f("#new_comm_"+h).fadeIn(4000);$body.animate({scrollTop:f("#new_comm_"+h).offset().top-200},900);j();h++;m="";f("*").remove("#edit_id");z.style.display="none";z.onclick=null;x.I("comment_parent").value="0";if(v&&B){v.parentNode.insertBefore(B,v);v.parentNode.removeChild(v)}}});return false});addComment={moveForm:function(y,z,D,x,A){var H=this,v,C=H.I(y),w=H.I(D),G=H.I("cancel-comment-reply-link"),E=H.I("comment_parent"),F=H.I("comment_post_ID");if(m){p()}A?(H.I("comment").value=q[A],m=H.I("new_comm_"+A).innerHTML.match(/(comment-)(\d+)/)[2],$new_sucs=f("#success_"+A),$new_sucs.hide(),$new_comm=f("#new_comm_"+A),$new_comm.hide(),$cancel.text(c)):$cancel.text(cancel_text);H.respondId=D;x=x||false;if(!H.I("wp-temp-form-div")){v=document.createElement("div");v.id="wp-temp-form-div";v.style.display="none";w.parentNode.insertBefore(v,w)}!C?(temp=H.I("wp-temp-form-div"),H.I("comment_parent").value="0",temp.parentNode.insertBefore(w,temp),temp.parentNode.removeChild(temp)):C.parentNode.insertBefore(w,C.nextSibling);$body.animate({scrollTop:f("#respond").offset().top-180},400);if(F&&x){F.value=x}E.value=z;G.style.display="";G.onclick=function(){if(m){p()}var J=addComment,I=J.I("wp-temp-form-div"),K=J.I(J.respondId);J.I("comment_parent").value="0";if(I&&K){I.parentNode.insertBefore(K,I);I.parentNode.removeChild(I)}this.style.display="none";this.onclick=null;return false};try{H.I("comment").focus()}catch(B){}return false},I:function(v){return document.getElementById(v)}};function p(){$new_comm.show();$new_sucs.show();f("textarea").each(function(){this.value=""});m=""}var o=15,g=$submit.val();function j(){if(o>0){$submit.val(o);o--;setTimeout(j,1000)}else{$submit.val(g).attr("disabled",false).fadeTo("slow",1);o=15}}});